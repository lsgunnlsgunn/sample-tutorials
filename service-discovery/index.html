<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Sample mini-site for cluster tutorials"><meta name=author content="Lisa Gunn - Information Developer"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="One matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../assets/images/favicon.ico><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.4.0"><title>Discover deployed services - Tutorials</title><link rel=stylesheet href=../assets/stylesheets/application.0284f74d.css><link rel=stylesheet href=../assets/stylesheets/application-palette.01803549.css><meta name=theme-color content=#3f51b5><script src=../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../assets/fonts/material-icons.css><link rel=stylesheet href=../assets/extra.css></head> <body dir=ltr data-md-color-primary=indigo data-md-color-accent=green> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#discover-deployed-services tabindex=1 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=.. title=Tutorials class="md-header-nav__button md-logo"> <img src=../global-img/gunnLogo.gif width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Tutorials </span> <span class=md-header-nav__topic> Discover deployed services </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder="Search the content" autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. title="Welcome to DC/OS Tutorials" class=md-tabs__link> Welcome to DC/OS Tutorials </a> </li> <li class=md-tabs__item> <a href=../intro/ title="Get started" class=md-tabs__link> Get started </a> </li> <li class=md-tabs__item> <a href=../first-app/ title="Deploy apps" class=md-tabs__link> Deploy apps </a> </li> <li class=md-tabs__item> <a href=./ title="Publish apps" class="md-tabs__link md-tabs__link--active"> Publish apps </a> </li> <li class=md-tabs__item> <a href=../resources/ title="Manage resources" class=md-tabs__link> Manage resources </a> </li> </ul> </div> </nav> <main class=md-main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=.. title=Tutorials class="md-nav__button md-logo"> <img src=../global-img/gunnLogo.gif width=48 height=48> </a> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. title="Welcome to DC/OS Tutorials" class=md-nav__link> Welcome to DC/OS Tutorials </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Get started </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Get started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../intro/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../start-here/start-here/ title="Create a cluster" class=md-nav__link> Create a cluster </a> </li> <li class=md-nav__item> <a href=../cli/ title="Install the CLI" class=md-nav__link> Install the CLI </a> </li> <li class=md-nav__item> <a href=../first-package/ title="Install the first package" class=md-nav__link> Install the first package </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Deploy apps </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Deploy apps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../first-app/ title="Deploy the first app" class=md-nav__link> Deploy the first app </a> </li> <li class=md-nav__item> <a href=../create-service/ title="Create and run custom apps" class=md-nav__link> Create and run custom apps </a> </li> <li class=md-nav__item> <a href=../schedule-jobs/ title="Create and schedule jobs" class=md-nav__link> Create and schedule jobs </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4 checked> <label class=md-nav__link for=nav-4> Publish apps </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Publish apps </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Discover deployed services </label> <a href=./ title="Discover deployed services" class="md-nav__link md-nav__link--active"> Discover deployed services </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Topics on this page</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#before-you-begin title="Before you begin" class=md-nav__link> Before you begin </a> </li> <li class=md-nav__item> <a href=#learning-objectives title="Learning objectives" class=md-nav__link> Learning objectives </a> </li> <li class=md-nav__item> <a href=#select-a-service-discovery-method title="Select a service discovery method" class=md-nav__link> Select a service discovery method </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#using-mesos-dns title="Using Mesos-DNS" class=md-nav__link> Using Mesos-DNS </a> </li> <li class=md-nav__item> <a href=#using-named-virtual-ip-addresses title="Using named virtual IP addresses" class=md-nav__link> Using named virtual IP addresses </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#next-steps title="Next steps" class=md-nav__link> Next steps </a> </li> <li class=md-nav__item> <a href=#related-topics title="Related topics" class=md-nav__link> Related topics </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../native-app/ title="Deploy and expose native container apps" class=md-nav__link> Deploy and expose native container apps </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Manage resources </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Manage resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../resources/ title="Allocate and scale resources" class=md-nav__link> Allocate and scale resources </a> </li> <li class=md-nav__item> <a href=../loadbalancing/ title="Load balancing workload" class=md-nav__link> Load balancing workload </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Topics on this page</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#before-you-begin title="Before you begin" class=md-nav__link> Before you begin </a> </li> <li class=md-nav__item> <a href=#learning-objectives title="Learning objectives" class=md-nav__link> Learning objectives </a> </li> <li class=md-nav__item> <a href=#select-a-service-discovery-method title="Select a service discovery method" class=md-nav__link> Select a service discovery method </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#using-mesos-dns title="Using Mesos-DNS" class=md-nav__link> Using Mesos-DNS </a> </li> <li class=md-nav__item> <a href=#using-named-virtual-ip-addresses title="Using named virtual IP addresses" class=md-nav__link> Using named virtual IP addresses </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#next-steps title="Next steps" class=md-nav__link> Next steps </a> </li> <li class=md-nav__item> <a href=#related-topics title="Related topics" class=md-nav__link> Related topics </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=discover-deployed-services>Discover deployed services<a class=headerlink href=#discover-deployed-services title="Permanent link">&para;</a></h1> <h4 class=summary>Demonstrates how to discover and connect to services in your DC/OS cluster</h4> <hr> <p>In the previous tutorial, you deployed a <a href=https://raw.githubusercontent.com/joerg84/dcos-101/master/app1/app1.py>sample app</a> that connected to the Redis service. If you reviewed the script for that app, you might have noticed these lines for connecting to the Redis service:</p> <pre><code>print(&quot;Running on node '&quot;+  os.getenv(&quot;HOST&quot;) + &quot;' and port '&quot; + os.getenv(&quot;PORT0&quot;))
r = redis.StrictRedis(host='redis.marathon.l4lb.thisdcos.directory', port=6379, db=0)
if r.ping():
     print(&quot;Redis Connected. Total number of keys:&quot;, len(r.keys()))
else:
     print(&quot;Could not connect to redis&quot;)
</code></pre> <p>In this excerpt from the sample app script, you can see that the app uses <code>redis.marathon.l4lb.thisdcos.directory</code> as the service address and port 6379 as the service port. It is important to note, however, that one of the advantages of a distributed computing environment is that a service--like the Redis service in this example--might be running on any agent in the cluster. In addition, the host address and the port number for accessing the service can change dynamically in response to changes in the cluster such as a failed node.</p> <p>This tutorial explores how DC/OS determines the IP addresses and ports where specific service instances are running.</p> <h2 id=before-you-begin>Before you begin<a class=headerlink href=#before-you-begin title="Permanent link">&para;</a></h2> <p>Before starting this tutorial, you should verify the following:</p> <ul> <li> <p>You have access to a running <a href=../start-here/ >DC/OS cluster</a> with at least at least one master node and three agent nodes.</p> </li> <li> <p>You have access to a computer where the <a href=../cli/ >DC/OS CLI</a> is installed.</p> </li> <li> <p>You have the sample <a href=/tutorials/dcos-101/app1/ >dcos-101/app1</a> application deployed and running in your cluster.</p> </li> <li> <p>You have the domain information command-line utility <code>dig</code> available on the computer you use to connect to the cluster. The <code>dig</code> utility is part of the DNS BIND utilities that are installed by default with most Linux distributions.</p> </li> </ul> <h2 id=learning-objectives>Learning objectives<a class=headerlink href=#learning-objectives title="Permanent link">&para;</a></h2> <p>By completing this tutorial, you will learn:</p> <ul> <li> <p>The service discovery options available in DC/OS.</p> </li> <li> <p>How DC/OS resolves service addresses to find running instances.</p> </li> </ul> <h2 id=select-a-service-discovery-method>Select a service discovery method<a class=headerlink href=#select-a-service-discovery-method title="Permanent link">&para;</a></h2> <p>In a DC/OS cluster, <a href=/1.13/networking/ >service discovery</a> provides a method for finding applications regardless of where they might be running in the cluster. With service discovery, you can find where deployed services are running in the DC/OS cluster in one of two ways:</p> <ul> <li> <p>By resolving private or public agent node IP addresses for tasks through the <strong>Mesos domain naming service (Mesos-DNS)</strong>.</p> </li> <li> <p>Through manually-set <strong>named virtual IP addresses</strong> that are not resolved through the Mesos domain naming service.</p> </li> </ul> <p>Keeping service discovery separate from traditional DNS name resolution (in which service records are associated with a specific physical or virtual IP addresses) is particularly useful in cases where applications fail and might be restarted on a different host.</p> <h3 id=using-mesos-dns>Using Mesos-DNS<a class=headerlink href=#using-mesos-dns title="Permanent link">&para;</a></h3> <p>The most common service discovery option is Mesos-DNS. Mesos-DNS provides a relatively simple method for finding applications inside the cluster. <a href=/networking/mesos-dns/ >Mesos-DNS</a> assigns DNS entries for every task. These task-specific DNS entries are then resolvable from any node in the cluster. </p> <p>The naming pattern for Mesos-DNS entries is <em>task.scheduler.mesos</em> Because the default scheduler for the Redis service you have deployed is <a href=/overview/architecture/components/#marathon>Marathon</a>, the Mesos-DNS name for your Redis service is <em>redis.marathon.mesos</em> or redis-tutorial.marathon.mesos.</p> <p>You can use DNS query tools, such as <a href=https://linux.die.net/man/1/dig>dig</a>, to retrieve address (A) and service (SRV) record from the DNS nameserver, which in a DC/OS cluster is configured to point at Mesos-DNS.</p> <p>For example, you can run a command similar to this to find the IP address (A) record where an instance of the <code>redis.marathon.mesos</code> service is running: <code>dig redis.marathon.mesos</code></p> <p>This command returns an answer section be similar to the following indicating that the service is running on the host with the IP address 10.0.0.43:</p> <p><code>;; ANSWER SECTION: redis.marathon.mesos. 60 IN A 10.0.0.43</code> To connect to the service, you also need to know the port. In retrieve this information, Mesos-DNS also assigns each Marathon app a service (SRV) record containing the port number. You can run a command similar to the following to find the Redis SRV record:</p> <p><code>dig srv _redis._tcp.marathon.mesos</code></p> <p>This command returns an answer section be similar to the following indicating that the Redis service is running on 10.0.0.43:30585</p> <p>``` ;; ANSWER SECTION: _redis._tcp.marathon.mesos. 60 IN SRV 0 0 30585 redis-1y1hj-s1.marathon.mesos.</p> <p>;; ADDITIONAL SECTION: redis-1y1hj-s1.marathon.mesos. 60 IN A 10.0.0.43 ```</p> <p>Using Mesos-DNS for service discovery is appropriate for many applications, but has the following drawbacks:</p> <ul> <li> <p>Applications sometimes cache DNS entries for efficiency and therefore might not provide updated address information in some cases, such as after a task failure.</p> </li> <li> <p>You need to use SRV DNS records to retrieve information about the allocated ports. While applications commonly understand DNS A records, not all applications support SRV records.</p> </li> </ul> <h3 id=using-named-virtual-ip-addresses>Using named virtual IP addresses<a class=headerlink href=#using-named-virtual-ip-addresses title="Permanent link">&para;</a></h3> <p><a href=/networking/load-balancing-vips/ >Named virtual IP addresses (VIPs)</a> enable you to assign name/port pairs to your apps. With this type of service discovery, you can give apps recognizable names with predictable port information. </p> <p>Virtual IP addresses also allow you to take advantage of DC/OS layer-4 load balancing when there are multiple instances of an application. For example, you can assign a named virtual IP address to the Redis service by adding the following to the app definition for the package:</p> <p><code>"VIP_0": "/redis:6379"</code></p> <p>The full name is then generated using the following format: <em>vip-name.scheduler.l4lb.thisdcos.directory:vip-port</em>.</p> <p>This is the discovery method used in the sample <a href=https://raw.githubusercontent.com/joerg84/dcos-101/master/app1/app1.py>application</a> for access the Redis service from within the cluster at <code>redis.marathon.l4lb.thisdcos.directory:6379</code>.</p> <p>Named VIPs load balance the IP address/port pair using an intelligent algorithm to ensure optimal routing of the traffic in relation to the original requestor, and also provide a local caching layer for high performance. They also allow you to give your apps meaningful names and select a specific port. Because of these advantages over Mesos-DNS,in most cases you should use named virtual IP addresses for service discovery in DC/OS.</p> <h2 id=next-steps>Next steps<a class=headerlink href=#next-steps title="Permanent link">&para;</a></h2> <p>You know how to use service discovery to connect to your application from within your DC/OS cluster, and have learned about the two mechanisms for service discovery available in DC/OS.</p> <h2 id=related-topics>Related topics<a class=headerlink href=#related-topics title="Permanent link">&para;</a></h2> <p>Now that you have a basic introduction to <a href=#mesos-dns>Mesos-DNS</a> and <a href=#named-vips>named virtual IP address</a> networking. You might want to explore these network options in more detail.</p> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../schedule-jobs/ title="Create and schedule jobs" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> Create and schedule jobs </span> </div> </a> <a href=../native-app/ title="Deploy and expose native container apps" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Next </span> Deploy and expose native container apps </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2019. All rights reserved. </div> </div> <div class=md-footer-social> <link rel=stylesheet href=../assets/fonts/font-awesome.css> <a href=https://github.com/lsgunnlsgunn class="md-footer-social__link fa fa-github"></a> <a href=https://twitter.com/gunncomm class="md-footer-social__link fa fa-twitter"></a> <a href=https://linkedin.com/in/lisagunn class="md-footer-social__link fa fa-linkedin"></a> </div> </div> </div> </footer> </div> <script src=../assets/javascripts/application.245445c6.js></script> <script>app.initialize({version:"1.0.4",url:{base:".."}})</script> <script src=../javascripts/extra.js></script> </body> </html>