<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Sample mini-site for cluster tutorials"><meta name=author content="Lisa Gunn - Information Developer"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="One matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../assets/images/favicon.ico><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.4.0"><title>Allocate and scale resources - Tutorials</title><link rel=stylesheet href=../assets/stylesheets/application.0284f74d.css><link rel=stylesheet href=../assets/stylesheets/application-palette.01803549.css><meta name=theme-color content=#3f51b5><script src=../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../assets/fonts/material-icons.css><link rel=stylesheet href=../assets/extra.css></head> <body dir=ltr data-md-color-primary=indigo data-md-color-accent=green> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#allocate-and-scale-resources tabindex=1 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=.. title=Tutorials class="md-header-nav__button md-logo"> <img src=../global-img/gunnLogo.gif width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Tutorials </span> <span class=md-header-nav__topic> Allocate and scale resources </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder="Search the content" autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. title="Welcome to DC/OS Tutorials" class=md-tabs__link> Welcome to DC/OS Tutorials </a> </li> <li class=md-tabs__item> <a href=../intro/ title="Get started" class=md-tabs__link> Get started </a> </li> <li class=md-tabs__item> <a href=../first-app/ title="Deploy apps" class=md-tabs__link> Deploy apps </a> </li> <li class=md-tabs__item> <a href=../service-discovery/ title="Publish apps" class=md-tabs__link> Publish apps </a> </li> <li class=md-tabs__item> <a href=./ title="Manage resources" class="md-tabs__link md-tabs__link--active"> Manage resources </a> </li> </ul> </div> </nav> <main class=md-main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=.. title=Tutorials class="md-nav__button md-logo"> <img src=../global-img/gunnLogo.gif width=48 height=48> </a> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. title="Welcome to DC/OS Tutorials" class=md-nav__link> Welcome to DC/OS Tutorials </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Get started </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Get started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../intro/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../start-here/start-here/ title="Create a cluster" class=md-nav__link> Create a cluster </a> </li> <li class=md-nav__item> <a href=../cli/ title="Install the CLI" class=md-nav__link> Install the CLI </a> </li> <li class=md-nav__item> <a href=../first-package/ title="Install the first package" class=md-nav__link> Install the first package </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Deploy apps </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Deploy apps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../first-app/ title="Deploy the first app" class=md-nav__link> Deploy the first app </a> </li> <li class=md-nav__item> <a href=../create-service/ title="Create and run custom apps" class=md-nav__link> Create and run custom apps </a> </li> <li class=md-nav__item> <a href=../schedule-jobs/ title="Create and schedule jobs" class=md-nav__link> Create and schedule jobs </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Publish apps </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Publish apps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../service-discovery/ title="Discover deployed services" class=md-nav__link> Discover deployed services </a> </li> <li class=md-nav__item> <a href=../native-app/ title="Deploy and expose native container apps" class=md-nav__link> Deploy and expose native container apps </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5 checked> <label class=md-nav__link for=nav-5> Manage resources </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Manage resources </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Allocate and scale resources </label> <a href=./ title="Allocate and scale resources" class="md-nav__link md-nav__link--active"> Allocate and scale resources </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Topics on this page</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#orchestration-and-cluster-management title="Orchestration and cluster management" class=md-nav__link> Orchestration and cluster management </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cluster-resiliency title="Cluster resiliency" class=md-nav__link> Cluster resiliency </a> </li> <li class=md-nav__item> <a href=#resource-allocation-and-usage title="Resource allocation and usage" class=md-nav__link> Resource allocation and usage </a> </li> <li class=md-nav__item> <a href=#service-identification-and-management title="Service identification and management" class=md-nav__link> Service identification and management </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#before-you-begin title="Before you begin" class=md-nav__link> Before you begin </a> </li> <li class=md-nav__item> <a href=#learning-objectives title="Learning objectives" class=md-nav__link> Learning objectives </a> </li> <li class=md-nav__item> <a href=#review-the-app-definition title="Review the app definition" class=md-nav__link> Review the app definition </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#resource-allocation-before-scaling title="Resource allocation before scaling" class=md-nav__link> Resource allocation before scaling </a> </li> <li class=md-nav__item> <a href=#using-groups-for-common-resource-requirements title="Using groups for common resource requirements" class=md-nav__link> Using groups for common resource requirements </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#scale-applications title="Scale applications" class=md-nav__link> Scale applications </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#scale-the-application-group title="Scale the application group" class=md-nav__link> Scale the application group </a> </li> <li class=md-nav__item> <a href=#set-instance-count-directly title="Set instance count directly" class=md-nav__link> Set instance count directly </a> </li> <li class=md-nav__item> <a href=#scale-allocated-resources title="Scale allocated resources" class=md-nav__link> Scale allocated resources </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#debug-resource-problems title="Debug resource problems" class=md-nav__link> Debug resource problems </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#not-enough-resources-in-the-cluster title="Not enough resources in the cluster" class=md-nav__link> Not enough resources in the cluster </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#symptom title=Symptom class=md-nav__link> Symptom </a> </li> <li class=md-nav__item> <a href=#cause title=Cause class=md-nav__link> Cause </a> </li> <li class=md-nav__item> <a href=#solution title=Solution class=md-nav__link> Solution </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#not-enough-resources-on-a-single-node title="Not enough resources on a single node" class=md-nav__link> Not enough resources on a single node </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#symptom_1 title=Symptom class=md-nav__link> Symptom </a> </li> <li class=md-nav__item> <a href=#cause_1 title=Cause class=md-nav__link> Cause </a> </li> <li class=md-nav__item> <a href=#solution_1 title=Solution class=md-nav__link> Solution </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#insufficient-resource-allocation-or-resource-isolation title="Insufficient resource allocation or resource isolation" class=md-nav__link> Insufficient resource allocation or resource isolation </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#symptom_2 title=Symptom class=md-nav__link> Symptom </a> </li> <li class=md-nav__item> <a href=#cause_2 title=Cause class=md-nav__link> Cause </a> </li> <li class=md-nav__item> <a href=#solution_2 title=Solution class=md-nav__link> Solution </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#next-steps title="Next steps" class=md-nav__link> Next steps </a> </li> <li class=md-nav__item> <a href=#related-topics title="Related topics" class=md-nav__link> Related topics </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../loadbalancing/ title="Load balancing workload" class=md-nav__link> Load balancing workload </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Topics on this page</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#orchestration-and-cluster-management title="Orchestration and cluster management" class=md-nav__link> Orchestration and cluster management </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cluster-resiliency title="Cluster resiliency" class=md-nav__link> Cluster resiliency </a> </li> <li class=md-nav__item> <a href=#resource-allocation-and-usage title="Resource allocation and usage" class=md-nav__link> Resource allocation and usage </a> </li> <li class=md-nav__item> <a href=#service-identification-and-management title="Service identification and management" class=md-nav__link> Service identification and management </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#before-you-begin title="Before you begin" class=md-nav__link> Before you begin </a> </li> <li class=md-nav__item> <a href=#learning-objectives title="Learning objectives" class=md-nav__link> Learning objectives </a> </li> <li class=md-nav__item> <a href=#review-the-app-definition title="Review the app definition" class=md-nav__link> Review the app definition </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#resource-allocation-before-scaling title="Resource allocation before scaling" class=md-nav__link> Resource allocation before scaling </a> </li> <li class=md-nav__item> <a href=#using-groups-for-common-resource-requirements title="Using groups for common resource requirements" class=md-nav__link> Using groups for common resource requirements </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#scale-applications title="Scale applications" class=md-nav__link> Scale applications </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#scale-the-application-group title="Scale the application group" class=md-nav__link> Scale the application group </a> </li> <li class=md-nav__item> <a href=#set-instance-count-directly title="Set instance count directly" class=md-nav__link> Set instance count directly </a> </li> <li class=md-nav__item> <a href=#scale-allocated-resources title="Scale allocated resources" class=md-nav__link> Scale allocated resources </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#debug-resource-problems title="Debug resource problems" class=md-nav__link> Debug resource problems </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#not-enough-resources-in-the-cluster title="Not enough resources in the cluster" class=md-nav__link> Not enough resources in the cluster </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#symptom title=Symptom class=md-nav__link> Symptom </a> </li> <li class=md-nav__item> <a href=#cause title=Cause class=md-nav__link> Cause </a> </li> <li class=md-nav__item> <a href=#solution title=Solution class=md-nav__link> Solution </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#not-enough-resources-on-a-single-node title="Not enough resources on a single node" class=md-nav__link> Not enough resources on a single node </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#symptom_1 title=Symptom class=md-nav__link> Symptom </a> </li> <li class=md-nav__item> <a href=#cause_1 title=Cause class=md-nav__link> Cause </a> </li> <li class=md-nav__item> <a href=#solution_1 title=Solution class=md-nav__link> Solution </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#insufficient-resource-allocation-or-resource-isolation title="Insufficient resource allocation or resource isolation" class=md-nav__link> Insufficient resource allocation or resource isolation </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#symptom_2 title=Symptom class=md-nav__link> Symptom </a> </li> <li class=md-nav__item> <a href=#cause_2 title=Cause class=md-nav__link> Cause </a> </li> <li class=md-nav__item> <a href=#solution_2 title=Solution class=md-nav__link> Solution </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#next-steps title="Next steps" class=md-nav__link> Next steps </a> </li> <li class=md-nav__item> <a href=#related-topics title="Related topics" class=md-nav__link> Related topics </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=allocate-and-scale-resources>Allocate and scale resources<a class=headerlink href=#allocate-and-scale-resources title="Permanent link">&para;</a></h1> <h4 class=summary>Provides strategies and examples for scaling resources allocated for deployed applications</h4> <hr> <p>To this point, you have seen how to create a cluster and how to deploy and test applications and services that run on the cluster. You’ve worked with single commands and apps that run in Docker and DC/OS UCR containers. With this tutorial, you will see some of the key benefits provider by container orchestration and perform a few common resource scaling tasks.</p> <h2 id=orchestration-and-cluster-management>Orchestration and cluster management<a class=headerlink href=#orchestration-and-cluster-management title="Permanent link">&para;</a></h2> <p>Container orchestration plays a key role in cluster management. Container orchestration helps you manage the lifecycle for apps deployed on the cluster by providing features that address important requirements, such as resilient operation, resource allocation, and service management.</p> <h3 id=cluster-resiliency>Cluster resiliency<a class=headerlink href=#cluster-resiliency title="Permanent link">&para;</a></h3> <p>Container orchestration helps ensure resilient operation by: - Determining the appropriate location for the initial placement of containers based on the current state, size, and configuration of the cluster.</p> <ul> <li> <p>Supporting distributed processing and scaling to optimize performance, fault-tolerance, and high availability.</p> </li> <li> <p>Providing self-contained health monitoring and self-healing operations to resurrect failed containers or agents so activity can continue without disruption.</p> </li> <li> <p>Simplifying the deployment of software upgrades or downgrades.</p> </li> </ul> <h3 id=resource-allocation-and-usage>Resource allocation and usage<a class=headerlink href=#resource-allocation-and-usage title="Permanent link">&para;</a></h3> <p>Container orchestration improves your ability to manage resources allocation and monitor resource consumption by making sure containers get the specific resources they need to run, including: - Memory</p> <ul> <li> <p>CPU</p> </li> <li> <p>Disk</p> </li> <li> <p>GPU</p> </li> <li> <p>Volumes</p> </li> <li> <p>Ports</p> </li> <li> <p>IP addresses</p> </li> <li> <p>Images and artifacts</p> </li> </ul> <h3 id=service-identification-and-management>Service identification and management<a class=headerlink href=#service-identification-and-management title="Permanent link">&para;</a></h3> <p>In combination with other features, container orchestration helps you to organize, distribute, and monitor the services you deploy. For example, you can: - Add labels to services to create metadata for querying and organizing services.</p> <ul> <li> <p>Use groups or namespaces to define a hierarchy of services and the relationships between them, including dependencies.</p> </li> <li> <p>Monitor health and readiness to ensure applications are available and running properly.</p> </li> </ul> <p>This tutorial focuses on <strong>resource management</strong> and <strong>resource isolation</strong> between tasks. These two activities are core functions of any operating system and are central elements of effective cluster administration. In this tutorial, you will learn how to monitor resource usage, how resource limits are enforced, and how to debug resource management issues. For information about other aspects of container orchestration, see the <a href=#related-topics>Related topics</a> listed at the end of this tutorial.</p> <h2 id=before-you-begin>Before you begin<a class=headerlink href=#before-you-begin title="Permanent link">&para;</a></h2> <p>Before starting this tutorial, you should verify the following: - You have access to a running <a href=../start-here/ >DC/OS cluster</a> with at least at least one master node and three agent nodes.</p> <ul> <li> <p>You have access to a computer where the <a href=../cli/ >DC/OS CLI</a> is installed.</p> </li> <li> <p>You have the sample <a href=../native-app/ >dcos-101/app2</a> application deployed and running in your cluster.</p> </li> </ul> <h2 id=learning-objectives>Learning objectives<a class=headerlink href=#learning-objectives title="Permanent link">&para;</a></h2> <p>By completing this tutorial, you will learn: - How to add resource placement constraints for apps.</p> <ul> <li> <p>How to monitor and understand your resource utilization.</p> </li> <li> <p>How resource limits are enforced.</p> </li> <li> <p>How to debug resource management issues.</p> </li> </ul> <h2 id=review-the-app-definition>Review the app definition<a class=headerlink href=#review-the-app-definition title="Permanent link">&para;</a></h2> <p>If you take another look at the <a href=https://raw.githubusercontent.com/joerg84/dcos-101/master/app2/app2.json>app definition</a> for the <a href=https://github.com/joerg84/dcos-101/blob/master/app2/app2.go>app2</a> sample application, you can see the resources allocated for the app in the <code>cpus</code>, <code>mem</code>, <code>disk</code>, and <code>gpus</code> settings. For example:</p> <pre><code class=json>{
  &quot;id&quot;: &quot;/dcos-101/app2&quot;,
  &quot;cmd&quot;: &quot;chmod u+x app2 &amp;&amp; ./app2&quot;,
  &quot;args&quot;: null,
  &quot;user&quot;: null,
  &quot;env&quot;: null,
  &quot;instances&quot;: 1,
  &quot;cpus&quot;: 1,
  &quot;mem&quot;: 128,
  &quot;disk&quot;: 0,
  &quot;gpus&quot;: 0,
  &quot;executor&quot;: null,
  &quot;constraints&quot;: null,
</code></pre> <h3 id=resource-allocation-before-scaling>Resource allocation before scaling<a class=headerlink href=#resource-allocation-before-scaling title="Permanent link">&para;</a></h3> <p>The values for <code>cpus</code>, <code>mem</code>, <code>disk</code>, and <code>gpus</code> define the <strong>maximum</strong> for each of these resources that a task can use. Tasks rarely use the maximum resources allocated, but these settings specify an upper limit to what you will allow a task to use.</p> <h3 id=using-groups-for-common-resource-requirements>Using groups for common resource requirements<a class=headerlink href=#using-groups-for-common-resource-requirements title="Permanent link">&para;</a></h3> <p>You might have noticed that the identifier in the app definitions for both <a href=https://raw.githubusercontent.com/joerg84/dcos-101/master/app1/app1.json>app1</a> and <a href=https://github.com/joerg84/dcos-101/blob/master/app2/app2.go>app2</a> is prefixed by <code>/dcos-101/</code>. </p> <p>This common identifier is used to define the specific <strong>application group</strong> that both sample applications belong to. Application groups allow you to specify and apply configuration details and dependencies to multiple applications at the same time.</p> <h2 id=scale-applications>Scale applications<a class=headerlink href=#scale-applications title="Permanent link">&para;</a></h2> <p>When you need more resources for your application, you can scale resources <strong>horizontally</strong> or <strong>vertically</strong>.</p> <p>Horizontal scaling involves increasing or decreasing the number of instances of an application. You can scale the instance count in two ways:</p> <ul> <li>By setting a factor to apply to an entire application group by a factor.</li> <li>By setting a specific number of instances for an individual application.</li> </ul> <h3 id=scale-the-application-group>Scale the application group<a class=headerlink href=#scale-the-application-group title="Permanent link">&para;</a></h3> <p>Since both <code>appl</code> and <code>app2</code> sample application share the same application group, you can scale them together.</p> <p>To see how you can scale up and scale down an entire application group, do the following:</p> <ol> <li> <p>Scale the application group up using a scale factor of two by running the following command:</p> <p><code>bash dcos marathon group scale dcos-101 2</code></p> </li> <li> <p>Verify that both sample apps have scaled up by running the following command:</p> <p><code>bash dcos marathon app list</code></p> </li> <li> <p>Scale the application group down again by running the following command:</p> <p><code>bash dcos marathon group scale dcos-101 0.5</code></p> </li> <li> <p>Verify that both apps have scaled down by running the following command:</p> <p><code>bash dcos marathon app list</code></p> </li> </ol> <h3 id=set-instance-count-directly>Set instance count directly<a class=headerlink href=#set-instance-count-directly title="Permanent link">&para;</a></h3> <p>In some cases, you might want to scale a single application independently. To see how you can scale up and scale down an entire application group, do the following:</p> <ol> <li> <p>Scale <code>app2</code> to three instances by running the following command:</p> <p><code>bash dcos marathon app update /dcos-101/app2 instances=3</code></p> <p>The instance updates are applied incrementally to an existing app definition.</p> </li> <li> <p>Verify that <code>app2</code> has scaled by running the following command:</p> <p><code>bash dcos marathon app list</code></p> </li> <li> <p>Scale <code>app2</code> back to one instance by running the following command:</p> <p><code>bash dcos marathon app update /dcos-101/app2 instances=1</code></p> </li> <li> <p>Verify that <code>app2</code> has scaled by running the following command:</p> <p><code>bash dcos marathon app list</code></p> </li> </ol> <h3 id=scale-allocated-resources>Scale allocated resources<a class=headerlink href=#scale-allocated-resources title="Permanent link">&para;</a></h3> <p>Vertical scaling involves increasing or decreasing the resources, such as CPU or memory, that are allocated to an application instance. You should keep in mind that vertical scaling requires restarting the application, which can affect service availability. In a production environment, you should plan for resource scaling and incorporate any changes into your scheduled maintenance periods, if possible.</p> <ol> <li> <p>Scale up to two CPUs for the <code>app2</code> instance by running the following command:</p> <p><code>bash dcos marathon app update /dcos-101/app2 cpus=2</code></p> </li> <li> <p>Verify that <code>app2</code> has scaled by running the following command:</p> <p><code>bash dcos marathon app list</code></p> </li> <li> <p>Scale back down to one CPU for the <code>app2</code> instance by running the following command:</p> <p><code>bash dcos marathon app update /dcos-101/app2 cpus=1</code></p> </li> </ol> <h2 id=debug-resource-problems>Debug resource problems<a class=headerlink href=#debug-resource-problems title="Permanent link">&para;</a></h2> <p>When you are managing resources for the applications running on the DC/OS cluster, there are a few common issues that you should learn how to identify and address. The next topics cover a few of these cases.</p> <h3 id=not-enough-resources-in-the-cluster>Not enough resources in the cluster<a class=headerlink href=#not-enough-resources-in-the-cluster title="Permanent link">&para;</a></h3> <p>To simulate this issue, try increasing the number of <code>app2</code> instances by running a command similar to the following: <code>dcos marathon app update /dcos-101/app2 instances=100</code></p> <p>This example increases the number of instances to 100. If you have a large cluster, you might need to set the number of instances even higher.</p> <h4 id=symptom>Symptom<a class=headerlink href=#symptom title="Permanent link">&para;</a></h4> <p>After increasing the number of instances, run <code>dcos marathon app list</code> or <code>dcos marathon deployment list</code> to check that the <code>scale</code> deployment is stuck.</p> <h4 id=cause>Cause<a class=headerlink href=#cause title="Permanent link">&para;</a></h4> <p>The problem here is that there are no matching resources available. For example, there might be resources left for the public agent role, but not for the default role.</p> <h4 id=solution>Solution<a class=headerlink href=#solution title="Permanent link">&para;</a></h4> <p>To resolve this issue, you can add nodes to the cluster or scale the application back to a level at which resources are available. For example, run a command similar to the following: <code>dcos marathon app update /dcos-101/app2 --force instances=1</code></p> <p>You must use the <code>--force</code> option in this command because the previous deployment is ongoing.</p> <h3 id=not-enough-resources-on-a-single-node>Not enough resources on a single node<a class=headerlink href=#not-enough-resources-on-a-single-node title="Permanent link">&para;</a></h3> <p>Because each application is started on a single node, task resources must also fit onto a single node. To simulate this issue, try updating the <code>app2</code> app to use 100 CPUs by running a command similar to the following: <code>dcos marathon app update /dcos-101/app2 cpus=100</code></p> <h4 id=symptom_1>Symptom<a class=headerlink href=#symptom_1 title="Permanent link">&para;</a></h4> <p>After increasing the number of CPUs, run <code>dcos marathon app list</code> or <code>dcos marathon deployment list</code> to check that the <code>restart</code> deployment is stuck.</p> <h4 id=cause_1>Cause<a class=headerlink href=#cause_1 title="Permanent link">&para;</a></h4> <p>The problem here is that there are no resource offers large enough to match the request.</p> <h4 id=solution_1>Solution<a class=headerlink href=#solution_1 title="Permanent link">&para;</a></h4> <p>To resolve this issue, you can provision larger or scale the application back to a level at which it fits onto the free resources on a single node. For example, run a command similar to the following: <code>dcos marathon app update /dcos-101/app2 --force cpus=1</code></p> <p>You must use the <code>--force</code> option in this command because the previous deployment is ongoing.</p> <h2 id=insufficient-resource-allocation-or-resource-isolation>Insufficient resource allocation or resource isolation<a class=headerlink href=#insufficient-resource-allocation-or-resource-isolation title="Permanent link">&para;</a></h2> <p>In some cases, you might have an application that attempts to use more resources than it is allocated. This is a common problem with memory consumption in conjunction with JVM-based applications. To simulate this issue, try deploying the sample <a href=https://github.com/joerg84/dcos-101/blob/master/oomApp/oomApp.go>out-of-memory app</a> by running the following command: <code>dcos marathon app add https://raw.githubusercontent.com/joerg84/dcos-101/master/oomApp/oomApp.json</code></p> <h4 id=symptom_2>Symptom<a class=headerlink href=#symptom_2 title="Permanent link">&para;</a></h4> <p>After deploying the sample app, check the Marathon log to see if it includes Out of Memory errors. (Because the kernel is killing the app, the errors are not always visible to DC/OS.)</p> <ol> <li> <p>Open a terminal and secure shell (SSH) session on an agent where the app run by running a command similar to the following:</p> <p><code>bash dcos node ssh --master-proxy --mesos-id=$(dcos task oom-app --json | jq -r '.[] | .slave_id')`</code></p> </li> <li> <p>Check the kernel log by running the following command:</p> <p><code>bash journalctl -f _TRANSPORT=kernel`</code></p> <p>The log file should include a message similar to the following:</p> <p><code>Memory cgroup out of memory: Kill process 10106 (oomApp) score 925 or sacrifice child; Killed process 10390 (oomApp) total-vm:3744760kB, anon-rss:60816kB, file-rss:1240kB, shmem-rss:0kB`</code></p> <h4 id=cause_2>Cause<a class=headerlink href=#cause_2 title="Permanent link">&para;</a></h4> <p>In most cases, there are two potential reasons for your application to be using too much memory:</p> </li> <li> <p>There are issues in the application code causing the app to use too much memory, for example, because there is a memory leak in the code logic.</p> </li> <li>You have allocated too little memory for the application.</li> </ol> <h4 id=solution_2>Solution<a class=headerlink href=#solution_2 title="Permanent link">&para;</a></h4> <p>To resolve these potential issues, check the application code to correct any programming errors such. If the problem is not in the code itself, increase the amount of memory you have allocated for the application.</p> <p>To complete this tutorial, be sure to remove the out-of-memory application by running the following command:</p> <pre><code class=bash>dcos marathon app remove /dcoc-101/oom-app
</code></pre> <h2 id=next-steps>Next steps<a class=headerlink href=#next-steps title="Permanent link">&para;</a></h2> <p>In this tutorial, you learned how to view the resources allocated for application tasks and how to scale and debug potential resource issues.</p> <h2 id=related-topics>Related topics<a class=headerlink href=#related-topics title="Permanent link">&para;</a></h2> <p>Now that you are practically a pro, you might want to begin exploring more advanced topics and configuration options such as: - Using application groups and <a href=../../task-labels/ >labels</a></p> <ul> <li> <p>Defining <a href=/1.13/deploying-services/marathon-constraints/ >placement constraints</a></p> </li> <li> <p>Deploying applications in <a href=/1.13/deploying-services/pods/ >pods</a></p> </li> </ul> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../native-app/ title="Deploy and expose native container apps" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> Deploy and expose native container apps </span> </div> </a> <a href=../loadbalancing/ title="Load balancing workload" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Next </span> Load balancing workload </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2019. All rights reserved. </div> </div> <div class=md-footer-social> <link rel=stylesheet href=../assets/fonts/font-awesome.css> <a href=https://github.com/lsgunnlsgunn class="md-footer-social__link fa fa-github"></a> <a href=https://twitter.com/gunncomm class="md-footer-social__link fa fa-twitter"></a> <a href=https://linkedin.com/in/lisagunn class="md-footer-social__link fa fa-linkedin"></a> </div> </div> </div> </footer> </div> <script src=../assets/javascripts/application.245445c6.js></script> <script>app.initialize({version:"1.0.4",url:{base:".."}})</script> <script src=../javascripts/extra.js></script> </body> </html>