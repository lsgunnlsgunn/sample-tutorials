<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Sample mini-site for cluster tutorials"><meta name=author content="Lisa Gunn - Information Developer"><meta name=lang:clipboard.copy content="Copy to clipboard"><meta name=lang:clipboard.copied content="Copied to clipboard"><meta name=lang:search.language content=en><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content="No matching documents"><meta name=lang:search.result.one content="One matching document"><meta name=lang:search.result.other content="# matching documents"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../assets/images/favicon.ico><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.4.0"><title>Load balancing workload - Tutorials</title><link rel=stylesheet href=../assets/stylesheets/application.0284f74d.css><link rel=stylesheet href=../assets/stylesheets/application-palette.01803549.css><meta name=theme-color content=#3f51b5><script src=../assets/javascripts/modernizr.74668098.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../assets/fonts/material-icons.css><link rel=stylesheet href=../assets/extra.css></head> <body dir=ltr data-md-color-primary=indigo data-md-color-accent=green> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#load-balancing-workloads tabindex=1 class=md-skip> Skip to content </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=.. title=Tutorials class="md-header-nav__button md-logo"> <img src=../global-img/gunnLogo.gif width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Tutorials </span> <span class=md-header-nav__topic> Load balancing workload </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder="Search the content" autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. title="Welcome to DC/OS Tutorials" class=md-tabs__link> Welcome to DC/OS Tutorials </a> </li> <li class=md-tabs__item> <a href=../intro/ title="Get started" class=md-tabs__link> Get started </a> </li> <li class=md-tabs__item> <a href=../first-app/ title="Deploy apps" class=md-tabs__link> Deploy apps </a> </li> <li class=md-tabs__item> <a href=../service-discovery/ title="Publish apps" class=md-tabs__link> Publish apps </a> </li> <li class=md-tabs__item> <a href=../resources/ title="Manage resources" class="md-tabs__link md-tabs__link--active"> Manage resources </a> </li> </ul> </div> </nav> <main class=md-main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=.. title=Tutorials class="md-nav__button md-logo"> <img src=../global-img/gunnLogo.gif width=48 height=48> </a> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. title="Welcome to DC/OS Tutorials" class=md-nav__link> Welcome to DC/OS Tutorials </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> Get started </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Get started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../intro/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../start-here/start-here/ title="Create a cluster" class=md-nav__link> Create a cluster </a> </li> <li class=md-nav__item> <a href=../cli/ title="Install the CLI" class=md-nav__link> Install the CLI </a> </li> <li class=md-nav__item> <a href=../first-package/ title="Install the first package" class=md-nav__link> Install the first package </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Deploy apps </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Deploy apps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../first-app/ title="Deploy the first app" class=md-nav__link> Deploy the first app </a> </li> <li class=md-nav__item> <a href=../create-service/ title="Create and run custom apps" class=md-nav__link> Create and run custom apps </a> </li> <li class=md-nav__item> <a href=../schedule-jobs/ title="Create and schedule jobs" class=md-nav__link> Create and schedule jobs </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> Publish apps </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> Publish apps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../service-discovery/ title="Discover deployed services" class=md-nav__link> Discover deployed services </a> </li> <li class=md-nav__item> <a href=../native-app/ title="Deploy and expose native container apps" class=md-nav__link> Deploy and expose native container apps </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5 checked> <label class=md-nav__link for=nav-5> Manage resources </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Manage resources </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../resources/ title="Allocate and scale resources" class=md-nav__link> Allocate and scale resources </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Load balancing workload </label> <a href=./ title="Load balancing workload" class="md-nav__link md-nav__link--active"> Load balancing workload </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Topics on this page</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#before-you-begin title="Before you begin" class=md-nav__link> Before you begin </a> </li> <li class=md-nav__item> <a href=#learning-objectives title="Learning objectives" class=md-nav__link> Learning objectives </a> </li> <li class=md-nav__item> <a href=#add-application-instances title="Add application instances" class=md-nav__link> Add application instances </a> </li> <li class=md-nav__item> <a href=#load-balancing-with-marathon-lb title="Load balancing with Marathon-LB" class=md-nav__link> Load balancing with Marathon-LB </a> </li> <li class=md-nav__item> <a href=#load-balancing-with-virtual-ips-addresses title="Load balancing with virtual IPs addresses" class=md-nav__link> Load balancing with virtual IPs addresses </a> </li> <li class=md-nav__item> <a href=#remove-extra-application-instances title="Remove extra application instances" class=md-nav__link> Remove extra application instances </a> </li> <li class=md-nav__item> <a href=#next-steps title="Next steps" class=md-nav__link> Next steps </a> </li> <li class=md-nav__item> <a href=#related-topics title="Related topics" class=md-nav__link> Related topics </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Topics on this page</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#before-you-begin title="Before you begin" class=md-nav__link> Before you begin </a> </li> <li class=md-nav__item> <a href=#learning-objectives title="Learning objectives" class=md-nav__link> Learning objectives </a> </li> <li class=md-nav__item> <a href=#add-application-instances title="Add application instances" class=md-nav__link> Add application instances </a> </li> <li class=md-nav__item> <a href=#load-balancing-with-marathon-lb title="Load balancing with Marathon-LB" class=md-nav__link> Load balancing with Marathon-LB </a> </li> <li class=md-nav__item> <a href=#load-balancing-with-virtual-ips-addresses title="Load balancing with virtual IPs addresses" class=md-nav__link> Load balancing with virtual IPs addresses </a> </li> <li class=md-nav__item> <a href=#remove-extra-application-instances title="Remove extra application instances" class=md-nav__link> Remove extra application instances </a> </li> <li class=md-nav__item> <a href=#next-steps title="Next steps" class=md-nav__link> Next steps </a> </li> <li class=md-nav__item> <a href=#related-topics title="Related topics" class=md-nav__link> Related topics </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=load-balancing-workloads>Load balancing workloads<a class=headerlink href=#load-balancing-workloads title="Permanent link">&para;</a></h1> <h4 class=summary>Demonstrates distributing workload for clients requesting access to a deployed application</h4> <hr> <p>Conceptually, a load balancer provides a network communication layer for distributing client requests to applications. Load balancers are particularly important in a clustered network environment because they determine which instance of an application should respond to internal or external service requests. With DC/OS clusters, you have several options for distributing service requests through a load balancer:</p> <ul> <li> <p>You can use named <a href=https://docs.mesosphere.com/1.13/networking/load-balancing-vips/virtual-ip-addresses/ >virtual IP addresses</a> and the native distributed layer-4 load balancing service <code>dcos-l4lb</code> (previously known as Minuteman).</p> </li> <li> <p>You can use the <a href=https://docs.mesosphere.com/services/marathon-lb/1.13/ >Marathon-LB</a> implementation of the [HAProxy] open-source load balancing service if all of your deployed applications use Marathon app definitions. </p> </li> <li> <p>You can use <a href=https://docs.mesosphere.com/services/edge-lb/ >Edge-LB</a> layer-7 proxy and load balancing service to distribute inbound access requests for a DC/OS Enterprise cluster.</p> </li> <li> <p>You can use an external hardware or cloud provider load balancing service, such as the <a href=https://aws.amazon.com/elasticloadbalancing/ >AWS Elastic Load Balancer (ELB)</a> in combination with Marathon-LB or Edge-LB for multi-tiered routing of inbound requests.</p> </li> </ul> <p>You have already explored two of these load balancing options in previous tutorials that illustrated <a href=../service-discovery/ >service discovery</a>, and using Marathon-LB to <a href=../native-app/ >expose an application on a public agent node</a>. Because this is a key task for managing cluster operations, this tutorial provides a more detailed example of how to configure load balancing for the simple apps you've deployed so far.</p> <h2 id=before-you-begin>Before you begin<a class=headerlink href=#before-you-begin title="Permanent link">&para;</a></h2> <p>Before starting this tutorial, you should verify the following:</p> <ul> <li> <p>You have access to a running <a href=../start-here/ >DC/OS cluster</a> with at least at least one master node and three agent nodes.</p> </li> <li> <p>You have access to a computer where the <a href=../cli/ >DC/OS CLI</a> is installed.</p> </li> <li> <p>You have the <a href=../native-app/ >app2</a> sample application deployed and running in your cluster.</p> </li> <li> <p>You have <a href=(../native-app/)>Marathon-LB</a> deployed and running in your cluster.</p> </li> </ul> <h2 id=learning-objectives>Learning objectives<a class=headerlink href=#learning-objectives title="Permanent link">&para;</a></h2> <p>By completing this tutorial, you will learn:</p> <ul> <li> <p>How to scale your application to multiple instances.</p> </li> <li> <p>How internal and external services choose which instance to use once the application has been scaled.</p> </li> </ul> <h2 id=add-application-instances>Add application instances<a class=headerlink href=#add-application-instances title="Permanent link">&para;</a></h2> <ol> <li> <p>Scale the app2 sample application to two instances by running the following command:</p> <p><code>bash dcos marathon app update /dcos-101/app2 instances=2</code></p> </li> </ol> <h2 id=load-balancing-with-marathon-lb>Load balancing with Marathon-LB<a class=headerlink href=#load-balancing-with-marathon-lb title="Permanent link">&para;</a></h2> <ol> <li> <p>Check that you can access the application using the public agent node IP address and port 10000 by opening a web browser and navigating to the URL.</p> <p>For example, navigate to a URL similar to this: <code>http://&lt;public-node&gt;:10000</code>. </p> </li> <li> <p>Navigate to the application repeatedly to see the request being served by different instances of app2.</p> </li> <li> <p>Check the Marathon-LB statistics by accessing the HAProxy stats endpoint using a URL similar to this: <code>http://&lt;public-node&gt;:9090/haproxy?stats</code>.</p> </li> </ol> <h2 id=load-balancing-with-virtual-ips-addresses>Load balancing with virtual IPs addresses<a class=headerlink href=#load-balancing-with-virtual-ips-addresses title="Permanent link">&para;</a></h2> <ol> <li> <p>Open a terminal and use a secure shell (SSH) to connect to the leading master node by running the following command: </p> <p><code>bash dcos node ssh --master-proxy --leader</code></p> </li> <li> <p>Use cURL to get the raw HTML output from the application by running the following command:</p> <p><code>bash curl dcos-101app2.marathon.l4lb.thisdcos.directory:10000</code></p> </li> <li> <p>Repeat the previous step to see the request being served by different instances. </p> </li> </ol> <h2 id=remove-extra-application-instances>Remove extra application instances<a class=headerlink href=#remove-extra-application-instances title="Permanent link">&para;</a></h2> <ol> <li> <p>Scale the app2 application back to one instance by running the following command:</p> <p><code>bash dcos marathon app update /dcos-101/app2 instances=1</code></p> </li> </ol> <h2 id=next-steps>Next steps<a class=headerlink href=#next-steps title="Permanent link">&para;</a></h2> <p>You have now used Marathon-LB and virtual IP addresses to load balance requests for two different instances of your app.</p> <h2 id=related-topics>Related topics<a class=headerlink href=#related-topics title="Permanent link">&para;</a></h2> <p>Consider these features and benefits when choosing the load balancing mechanism.</p> <ul> <li> <p><a href=/networking/marathon-lb/ >Marathon-LB</a> is a layer 7 load balancer that is mostly used for external requests. It is based on the well-known HAProxy load balancer and uses Marathon’s event bus to update its configuration in real time. Being a layer 7 load balancer, it supports session-based features such as HTTP sticky sessions and zero-downtime deployments.</p> </li> <li> <p><a href=/networking/load-balancing-vips/ >Named virtual IP addresses</a> are a layer 4 load balancer mechanism used for internal TCP traffic. As they are tightly integrated with the kernel, they provide a load balanced IP address which can be used from anywhere within the cluster.</p> </li> </ul> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../resources/ title="Allocate and scale resources" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Previous </span> Allocate and scale resources </span> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2019. All rights reserved. </div> </div> <div class=md-footer-social> <link rel=stylesheet href=../assets/fonts/font-awesome.css> <a href=https://github.com/lsgunnlsgunn class="md-footer-social__link fa fa-github"></a> <a href=https://twitter.com/gunncomm class="md-footer-social__link fa fa-twitter"></a> <a href=https://linkedin.com/in/lisagunn class="md-footer-social__link fa fa-linkedin"></a> </div> </div> </div> </footer> </div> <script src=../assets/javascripts/application.245445c6.js></script> <script>app.initialize({version:"1.0.4",url:{base:".."}})</script> <script src=../javascripts/extra.js></script> </body> </html>